inputs:
  - id: bucket_name
    name: The name of the bucket
  - id: bucket_tag_simple
    default: ""
    name: Bucket tags simple
  - id: bucket_tags_complex
    name: Bucket tags complex
    default: "{}"
stack:
  name: blueprint-bucket $${{ inputs.bucket_name }}
  space:  ${ poc_space_id }
  description: >
    generate .tf file and commit it back to the repo
  labels:
    - "blueprint"
    - "bucket:$${{ inputs.bucket_name }}"
  auto_deploy: true
  local_preview_enabled: true
  worker_pool: ${ worker_pool_id }
  environment:
    variables:
      - name: TF_VAR_bucket_name
        value: $${{ inputs.bucket_name }}
      - name: TF_VAR_bucket_tags_simple
        value: $${{ inputs.bucket_tag_simple }}
      - name: TF_VAR_bucket_tags_complex
        value: >-
          $${{ inputs.bucket_tags_complex }}
      - name: TF_VAR_username
        value: $${{ context.user.name }}
      - name: TF_VAR_user_login
        value: $${{ context.user.login }}

  vcs:
    branch: main
    repository: "POC"
    project_root: stacks/commit_to_repo
    provider: GITHUB
  vendor:
    terraform:
      manage_state: true
      version: "1.10.2"
      workflow_tool: OPEN_TOFU
  schedules:
    delete:
      delete_resources: false
      timestamp_unix: $${{ int(context.time) + 3600 }}
  attachments:
    contexts:
      - id: github-auth
        priority: 0
options:
  trigger_run: true