inputs:
  - id: bucket_name
    name: The name of the bucket
  - id: bucket_tag_simple
    default: ""
    name: Bucket tags simple
  - id: bucket_tags_complex
    name: Bucket tags complex
    default: "{}"
stack:
  name: blueprint-bucket ${{ inputs.bucket_name }}
  space: ${{ context.space.id }}
  description: >
    generate .tf file and commit it back to the repo
  labels:
    - "blueprint"
    - "bucket:${{ inputs.bucket_name }}"
  auto_deploy: true
  local_preview_enabled: true
  worker_pool: ${{ context.space.worker_pools.poc-local-k8s-pool }}
  environment:
    variables:
      - name: TF_VAR_bucket_name
        value: ${{ inputs.bucket_name }}
      - name: TF_VAR_bucket_tags_simple
        value: ${{ inputs.bucket_tag_simple }}
      - name: TF_VAR_bucket_tags_complex
        # This is a complex variable, so we need to ensure it's a valid JSON string
        value: >-
          ${{ inputs.bucket_tags_complex }}
      - name: TF_VAR_username
        value: ${{ context.user.name }}
      - name: TF_VAR_user_login
        value: ${{ context.user.login }}
      - name: TF_VAR_branch
        value: ${{ inputs.bucket_name }}

  vcs:
    branch: main
    repository: "POC"
    project_root: stacks/commit_to_repo/s3
    provider: GITHUB
  vendor:
    terraform:
      manage_state: true
      version: "1.10.2"
      workflow_tool: OPEN_TOFU
  schedules:
    delete:
      delete_resources: false
      timestamp_unix: ${{ int(context.time) + 3600 }}
  attachments:
    contexts:
      - id: github-auth
        priority: 0
options:
  trigger_run: true